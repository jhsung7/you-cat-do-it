import{e as J}from"./index-ff_Z8oB1.js";const m="healthLogs",S="cat-symptoms",y="cat-weight-logs",I="cat-vet-visits",h="cat-prescriptions",p="cat-mood-logs",r={getAll(){const t=localStorage.getItem(m);return t?JSON.parse(t).map(s=>{if(!s.timestamp){const e=new Date(`${s.date}T${s.time||"12:00"}`);return{...s,timestamp:e.getTime(),type:s.type||"general"}}return s}):[]},getByCatId(t){const o=this.getAll().filter(s=>s.catId===t);return console.log(`ðŸ“‹ Logs for cat ${t}:`,o),o},getRecent(t,o){const s=new Date;s.setDate(s.getDate()-o);const e=s.getTime(),l=this.getByCatId(t).filter(i=>i.timestamp>=e).sort((i,a)=>a.timestamp-i.timestamp);return console.log(`ðŸ“‹ Recent logs (${o} days) for cat ${t}:`,l),l},add(t){const o=this.getAll();o.push(t),localStorage.setItem(m,JSON.stringify(o)),console.log("âœ… Health log saved:",t),console.log("ðŸ“‹ Total logs now:",o.length)},update(t,o){const s=this.getAll(),e=s.findIndex(l=>l.id===t);e!==-1&&(s[e]={...s[e],...o},localStorage.setItem(m,JSON.stringify(s)),console.log("âœ… Health log updated:",s[e]))},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(m,JSON.stringify(o)),console.log("âœ… Health log deleted:",t)}},L={getAll(){const t=localStorage.getItem(S);return t?JSON.parse(t):[]},getByCatId(t){return this.getAll().filter(o=>o.catId===t)},add(t){const o=this.getAll();o.push(t),localStorage.setItem(S,JSON.stringify(o)),console.log("âœ… Symptom saved:",t)},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(S,JSON.stringify(o)),console.log("âœ… Symptom deleted:",t)}},A={getAll(){const t=localStorage.getItem(y);return t?JSON.parse(t):[]},getByCatId(t){return this.getAll().filter(o=>o.catId===t).sort((o,s)=>o.timestamp-s.timestamp)},add(t){const o=this.getAll();o.push(t),localStorage.setItem(y,JSON.stringify(o)),console.log("âœ… Weight log saved:",t)},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(y,JSON.stringify(o)),console.log("âœ… Weight log deleted:",t)}},u={getAll(){const t=localStorage.getItem(I);return t?JSON.parse(t):[]},getByCatId(t){return this.getAll().filter(o=>o.catId===t).sort((o,s)=>s.timestamp-o.timestamp)},add(t){const o=this.getAll();o.push(t),localStorage.setItem(I,JSON.stringify(o)),console.log("âœ… Vet visit saved:",t)},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(I,JSON.stringify(o)),console.log("âœ… Vet visit deleted:",t)}},O={getAll(){const t=localStorage.getItem(h);return t?JSON.parse(t):[]},getByCatId(t){return this.getAll().filter(o=>o.catId===t)},getByVisitId(t){return this.getAll().filter(o=>o.visitId===t)},add(t){const o=this.getAll();o.push(t),localStorage.setItem(h,JSON.stringify(o)),console.log("âœ… Prescription saved:",t)},update(t,o){const s=this.getAll(),e=s.findIndex(l=>l.id===t);e!==-1&&(s[e]={...s[e],...o},localStorage.setItem(h,JSON.stringify(s)),console.log("âœ… Prescription updated:",s[e]))},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(h,JSON.stringify(o)),console.log("âœ… Prescription deleted:",t)}},g={getAll(){const t=localStorage.getItem(p);return t?JSON.parse(t):[]},getByCatId(t){return this.getAll().filter(o=>o.catId===t).sort((o,s)=>s.timestamp-o.timestamp)},add(t){const o=this.getAll();o.push(t),localStorage.setItem(p,JSON.stringify(o)),console.log("âœ… Mood log saved:",t)},update(t,o){const s=this.getAll(),e=s.findIndex(l=>l.id===t);e!==-1&&(s[e]={...s[e],...o},localStorage.setItem(p,JSON.stringify(s)),console.log("âœ… Mood log updated:",s[e]))},delete(t){const o=this.getAll().filter(s=>s.id!==t);localStorage.setItem(p,JSON.stringify(o)),console.log("âœ… Mood log deleted:",t)}},c=7,N=c*2,D=t=>(t.foodAmount||0)+(t.wetFoodAmount||0)+(t.dryFoodAmount||0)+(t.snackAmount||0),T=t=>t.reduce((o,s)=>{const e=s.date||new Date(s.timestamp).toISOString().split("T")[0];return o[e]||(o[e]={date:e,food:0,water:0,litter:0}),o[e].food+=D(s),o[e].water+=s.waterAmount||0,o[e].litter+=s.litterCount||0,o},{}),M=(t,o)=>{const s=T(t),e=new Date,l=[];for(let i=o-1;i>=0;i--){const a=new Date(e);a.setDate(e.getDate()-i);const n=a.toISOString().split("T")[0];l.push(s[n]||{date:n,food:0,water:0,litter:0})}return l},w=(t,o)=>t.length===0?0:t.reduce((e,l)=>e+l[o],0)/t.length,_={food:"Food intake",water:"Water intake",litter:"Litter box visits"},$=(t,o)=>{const s=M(o,N);if(s.length<N)return[];const e=s.slice(0,c),l=s.slice(c),i=[];return["food","water","litter"].forEach(a=>{var v;const n=w(e,a),d=w(l,a);if(!n||d>=n||(n-d)/n<(a==="litter"||a==="water"?.4:.3))return;const f=Math.round((d-n)/n*100),C=Math.abs(f)>=50?"critical":"warning",B=`${_[a]} dropped ${Math.abs(f)}% over the last ${c} days (from ${n.toFixed(1)} to ${d.toFixed(1)}).`,V=`${t}-${a}-${((v=l[l.length-1])==null?void 0:v.date)||Date.now()}`;i.push({id:V,catId:t,metric:a,severity:C,description:B,changePercent:f,currentAverage:Number(d.toFixed(2)),previousAverage:Number(n.toFixed(2)),windowDays:c,detectedAt:Date.now()})}),i},x=J((t,o)=>{const s=e=>{if(!e)return;const l=r.getByCatId(e),i=$(e,l);t(a=>({anomaliesByCat:{...a.anomaliesByCat,[e]:i}}))};return{healthLogs:[],symptoms:[],weightLogs:[],vetVisits:[],prescriptions:[],moodLogs:[],anomaliesByCat:{},loadHealthLogs:e=>{const l=r.getByCatId(e);t({healthLogs:l}),s(e)},addHealthLog:e=>{r.add(e),t({healthLogs:[...o().healthLogs,e]}),s(e.catId)},updateHealthLog:(e,l)=>{const i=o().healthLogs.find(n=>n.id===e)||r.getAll().find(n=>n.id===e);r.update(e,l);const a=o().healthLogs.map(n=>n.id===e?{...n,...l}:n);t({healthLogs:a}),i!=null&&i.catId&&s(i.catId)},deleteHealthLog:e=>{const l=o().healthLogs.find(a=>a.id===e)||r.getAll().find(a=>a.id===e);r.delete(e);const i=o().healthLogs.filter(a=>a.id!==e);t({healthLogs:i}),l!=null&&l.catId&&s(l.catId)},loadSymptoms:e=>{const l=L.getByCatId(e);t({symptoms:l})},addSymptom:e=>{L.add(e),t({symptoms:[...o().symptoms,e]})},deleteSymptom:e=>{L.delete(e),t({symptoms:o().symptoms.filter(l=>l.id!==e)})},getRecentLogs:(e,l)=>r.getRecent(e,l),loadWeightLogs:e=>{const l=A.getByCatId(e);t({weightLogs:l})},addWeightLog:e=>{A.add(e),t({weightLogs:[...o().weightLogs,e]})},getWeightLogs:e=>A.getByCatId(e),loadVetVisits:e=>{const l=u.getByCatId(e);t({vetVisits:l})},addVetVisit:e=>{u.add(e),t({vetVisits:[...o().vetVisits,e]})},deleteVetVisit:e=>{u.delete(e),t({vetVisits:o().vetVisits.filter(l=>l.id!==e)})},getVetVisits:e=>u.getByCatId(e),addPrescription:e=>{O.add(e),t({prescriptions:[...o().prescriptions,e]})},updatePrescription:(e,l)=>{O.update(e,l);const i=o().prescriptions.map(a=>a.id===e?{...a,...l}:a);t({prescriptions:i})},getPrescriptionsByVisit:e=>O.getByVisitId(e),loadMoodLogs:e=>{const l=g.getByCatId(e);t({moodLogs:l})},addMoodLog:e=>{g.add(e),t({moodLogs:[...o().moodLogs,e]})},updateMoodLog:(e,l)=>{g.update(e,l);const i=o().moodLogs.map(a=>a.id===e?{...a,...l}:a);t({moodLogs:i})},deleteMoodLog:e=>{g.delete(e);const l=o().moodLogs.filter(i=>i.id!==e);t({moodLogs:l})},getMoodLogs:e=>g.getByCatId(e),getAnomalies:e=>o().anomaliesByCat[e]||[],recalcAnomalies:s}});export{x as u};
